# Xkcapt
This project provides tools for downloading, preparing, analyzing datasets for training a neural network to annotate images in different languages.

## Anchors
- [Requirements](Requirements)
- - [Download scripts](Download-scripts)
- - [Analysis scripts](Analysis-scripts)
- - - [dload_dataset](dload_dataset)
- - - [merge_mscoco_jsons](merge_mscoco_jsons)
- - - [raw2mscoco](raw2mscoco)
- [Installation](Installation)
- [Description](Description)

## Description

### Download scripts
This section based on downloading google's [Conceptual Captions Dataset](https://ai.google.com/research/ConceptualCaptions) and merging it with MSCOCO dataset.

Why exactly google dataset? Because it has more than 3 millions captioned images while MSCOCO has only ~200-300k. The scripts below allow you to download a dataset from Google and merge it with MSCOCO dataset, thereby increasing the total size of the training sample by ~10 times.

-----
#### dload_dataset
This module reads .tsv file with cells separated by tabs **"/t"** with following format:

**Template:**

Cell_1|Cell_2|
--- | ---
*annotation* | *URL*

**Example:**

Cell_1|Cell_2|
--- | ---
"a very typical bus station" | http://some_site_1.com/some_pic.jpg
"gangsta rap artist attends sports team vs playoff game in the borough ." | http://some_site_2.com/some_pic.jpg
"traditional ornamental floral paisley bandanna ." | http://some_site_3.com/some_pic.jpg

Script goes though all the cells and tries to download every picture. If the program fails to access then the cell number is added to the list of unloaded.

**Result JSON-file view:**

````JSON
{
    "tsv_source_fname": "string",
    "time spent": "int",
    "downloaded_flist": [
        {
          "cell_number": "int",
          "filename": "string",
          "caption": "string"
        }
    ],
    "error_clist":  [ "int", "int", "..." ]
}
````
-----
#### merge_mscoco_jsons
This module merges two MSCOCO json files into one. It takes two paths to json files as arguments.
It is worth noting that original MSCOCO dataset has the following feature: one picture may have two or more annotations so this module implements logic that preserves the correct annotation links to images.

It is understood that MSCOCO json files will have following format:

**Example:**
````JSON
{
      "info": {
          "description": "This is stable 1.0 version..",
          "url": "http://any_url.com",
          "version": "1.0",
          "year": 2017,
          "contributor": "Microsoft COCO.group",
          "date_created": "2017-01-27 09:11:52.357474",
      "images": [
              {
                  "licence": "int",
                  "file_name": "filename.jpg",
                  "coco_url": "http://any_url.com",
                  "height": 360,
                  "width": 640,
                  "date_captured": "2017-11-14 11:18:45",
                  "flick_url": "http://any_url.com",
                  "id": 391895
              }
          ],
      "licenses": [
              {
                  "url": "http://any_url.com",
                  "id": 1,
                  "name": "Attribution-NonCommercial-ShareAlike Licence"
              }
          ],
      "annotations": [
              {
                  "image_id": 203564,
                  "id": 37,
                  "caption": "A bicycle replica with a clock as the front wheel."
              }
          ]
      }
}
````
-----
#### raw2mscoco
This module simply converts .json generated by dload_dataset.py to mscoco .json format.

Since we do not know some information about the downloaded images (for example, year of creation, license), these cells are filled with the text "unknown".

**For the brevity of the code the output json will have only one license:**
````JSON
{
    "url": "http://flickr.com/commons/usage/",
    "id": 7,
    "name":
    "No known copyright restrictions"
}
````

**Template of source file (generated by [dload_dataset](dload_dataset)):**
````JSON
{
    "tsv_source_fname": "string",
    "time spent": "int",
    "downloaded_flist": [
        {
          "cell_number": "int",
          "filename": "string",
          "caption": "string"
        }
    ],
    "error_clist":  [ "int", "int", "..." ]
}
````
**Template of destination file (MSCOCO .json standard):**
````JSON
{
      "info": {
          "description": "This is stable 1.0 version..",
          "url": "http://any_url.com",
          "version": "1.0",
          "year": 2017,
          "contributor": "Microsoft COCO.group",
          "date_created": "2017-01-27 09:11:52.357474",
      "images": [
              {
                  "licence": "int",
                  "file_name": "filename.jpg",
                  "coco_url": "http://any_url.com",
                  "height": 360,
                  "width": 640,
                  "date_captured": "2017-11-14 11:18:45",
                  "flick_url": "http://any_url.com",
                  "id": 391895
              }
          ],
      "licenses": [
              {
                  "url": "http://any_url.com",
                  "id": 1,
                  "name": "Attribution-NonCommercial-ShareAlike Licence"
              }
          ],
      "annotations": [
              {
                  "image_id": 203564,
                  "id": 37,
                  "caption": "A bicycle replica with a clock as the front wheel."
              }
          ]
      }
}
````

### Analysis scripts

## Requirements

## Installation
